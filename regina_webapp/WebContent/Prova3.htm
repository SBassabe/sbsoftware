<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      canvas {
        border: 1px solid #9C9898;
      }
      #container {
        background-image: url('./images/EDIFICIO_A_PIANO_PRIMO.jpg');
        width: 1164px;
        height: 500px;
      }
    </style>
    <script src="./libraries/kinetic-v3.9.5.js"></script>
    <script>
      function updateDottedLines(layer) {
        var q = layer.quad;
        var b = layer.bezier;
        var c = layer.poly;

        var quadLine = layer.get('#quadLine')[0];
        var bezierLine = layer.get('#bezierLine')[0];
        var polyLine = layer.get('#polyLine')[0];

        quadLine.setPoints([
          q.start.attrs.x, q.start.attrs.y, 
          q.control.attrs.x, q.control.attrs.y, 
          q.end.attrs.x, q.end.attrs.y
        ]);

        bezierLine.setPoints([
          b.start.attrs.x, b.start.attrs.y, 
          b.control1.attrs.x, b.control1.attrs.y, 
          b.control2.attrs.x, b.control2.attrs.y,
          b.control3.attrs.x, b.control3.attrs.y,
          b.control4.attrs.x, b.control4.attrs.y,
          b.end.attrs.x, b.end.attrs.y
        ]);
        
        polyLine.setPoints([
          c.start.attrs.x, c.start.attrs.y, 
          c.control1.attrs.x, c.control1.attrs.y, 
          c.control2.attrs.x, c.control2.attrs.y,
          c.control3.attrs.x, c.control3.attrs.y,
          c.control4.attrs.x, c.control4.attrs.y,
          c.end.attrs.x, c.end.attrs.y
        ]);
      }
      function buildAnchor(layer, x, y, anchor) {
        var anchor = new Kinetic.Circle({
          x: x,
          y: y,
          radius: 2,
          stroke: "#666",
          fill: "#ddd",
          strokeWidth: 2,
          draggable: true
        });

        // add hover styling
        anchor.on("mouseover", function() {
          document.body.style.cursor = "pointer";
          this.setStrokeWidth(4);
          layer.draw();
        });
        anchor.on("mouseout", function() {
          document.body.style.cursor = "default";
          this.setStrokeWidth(2);
          layer.draw();
        });

        layer.add(anchor);
        return anchor;
      }
      function drawCurves() {
        var context = this.getContext();
        var layer = this.getLayer();

        ///////////////////////////////
        // draw quad
        ///////////////////////////////
        var quad = layer.quad;
        var bezier = layer.bezier;

        // draw quad
        context.beginPath();
        context.moveTo(quad.start.attrs.x, quad.start.attrs.y);
        context.quadraticCurveTo(quad.control.attrs.x, quad.control.attrs.y, quad.end.attrs.x, quad.end.attrs.y);
        context.strokeStyle = "red";
        context.lineWidth = 4;
        context.stroke();

        // draw bezier
        context.beginPath();
        context.moveTo(bezier.start.attrs.x, bezier.start.attrs.y);
        context.bezierCurveTo(bezier.control1.attrs.x, bezier.control1.attrs.y, bezier.control2.attrs.x, bezier.control2.attrs.y, bezier.end.attrs.x, bezier.end.attrs.y);
        context.strokeStyle = "blue";
        context.lineWidth = 4;
        context.stroke();
      }

      window.onload = function() {
        var stage = new Kinetic.Stage({
          container: "container",
          width: 1164,
          height: 500
        });

        var layer = new Kinetic.Layer({
          //drawFunc: drawCurves
        });

        var quadLine = new Kinetic.Line({
          //dashArray: [10, 10, 0, 10],
          strokeWidth: 3,
          stroke: "black",
          lineCap: "round",
          id: "quadLine",
          alpha: 0.3
        });

        var bezierLine = new Kinetic.Line({
          dashArray: [10, 10, 0, 11],
          strokeWidth: 3,
          stroke: "black",
          lineCap: "round",
          id: "bezierLine",
          alpha: 0.3
        });

        var poly = new Kinetic.Polygon({
	        //points: [73, 192, 73, 160, 340, 23, 500, 109, 499, 139, 342, 93],
	        fill: "#00D2FF",
	        alpha: 0.3,
	        stroke: "black",
	        strokeWidth: 3,
	        id: "polyLine"
        });
        
        // add dotted line connectors
        layer.add(quadLine);
        layer.add(bezierLine);
        layer.add(poly);
       
        /*
         * update the dotted line points before
         * drawing the layer
         */
        layer.beforeDraw(function() {
          updateDottedLines(layer);
        });
        /*
         * add custom property curve objects to layer so that
         * they can be modified by reference
         */
        layer.quad = {
          start: buildAnchor(layer, 60, 30),
          control: buildAnchor(layer, 240, 110),
          end: buildAnchor(layer, 80, 160)
        };

        layer.bezier = {
          start: buildAnchor(layer, 280, 20),
          control1: buildAnchor(layer, 530, 40),
          control2: buildAnchor(layer, 480, 150),
          control3: buildAnchor(layer, 330, 40),
          control4: buildAnchor(layer, 220, 150),
          end: buildAnchor(layer, 300, 150)
        };
        //[73, 192,   73, 160,   340, 23,   500, 109,   499, 139,   342, 93]
        layer.poly = {
          start: buildAnchor(layer, 73, 192),
          control1: buildAnchor(layer, 73, 160),
          control2: buildAnchor(layer, 340, 23),
          control3: buildAnchor(layer, 500, 109),
          control4: buildAnchor(layer, 499, 139),
          end: buildAnchor(layer, 342, 93)
        };
        
        stage.on("mouseout", function() {
          layer.draw();
        });

        stage.add(layer);
      };

    </script>
  </head>
  <body onmousedown="return false;">
    <div id="container"></div>
  </body>
</html>