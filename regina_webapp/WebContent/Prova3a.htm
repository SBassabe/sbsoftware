<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      canvas {
        border: 1px solid #9C9898;
      }
      #container {
        background-image: url('./images/EDIFICIO_A_PIANO_PRIMO.jpg');
        width: 1164px;
        height: 500px;
      }
    </style>
    <script src="./libraries/kinetic-v3.9.5.js"></script>
    <script src="./libraries/jquery-1.7.2.min.js"></script>
    <script>

     var stage;
     var layer;
    
     function updateDottedLines(layer) {
        var c = layer.poly;
        var polyLine = layer.get('#polyLine')[0];
    
        polyLine.setPoints([
          c.start.attrs.x, c.start.attrs.y, 
          c.control1.attrs.x, c.control1.attrs.y, 
          c.control2.attrs.x, c.control2.attrs.y,
          c.control3.attrs.x, c.control3.attrs.y,
          c.control4.attrs.x, c.control4.attrs.y,
          c.end.attrs.x, c.end.attrs.y
        ]);
      }
     
      function buildAnchor(layer, x, y, anchor) {
        var anchor = new Kinetic.Circle({
          x: x,
          y: y,
          radius: 2,
          stroke: "#666",
          fill: "#ddd",
          strokeWidth: 2,
          draggable: true
        });

        // add hover styling
        anchor.on("mouseover", function() {
          document.body.style.cursor = "pointer";
          this.setStrokeWidth(4);
          layer.draw();
        });
        anchor.on("mouseout", function() {
          document.body.style.cursor = "default";
          this.setStrokeWidth(2);
          layer.draw();
        });

        layer.add(anchor);
        return anchor;
      }

      window.onload = function() {
        stage = new Kinetic.Stage({
          container: "container",
          width: 1164,
          height: 500
        });

        layer = new Kinetic.Layer({
          //drawFunc: drawCurves
        });

        var poly = new Kinetic.Polygon({
	        //points: [73, 192, 73, 160, 340, 23, 500, 109, 499, 139, 342, 93],
	        fill: "#00D2FF",
	        alpha: 0.3,
	        stroke: "black",
	        strokeWidth: 3,
	        id: "polyLine"
        });

        var poly2 = new Kinetic.Polygon({
	        points: [73, 192, 73, 160, 340, 23, 500, 109, 499, 139, 342, 93],
	        //points: [626,401,628,324,744,324,994,323,996,403,628,402],
	        fill: "#00D2F0",
	        alpha: 0.2,
	        stroke: "#00D2F0",
	        strokeWidth: 0,
	        id: "polyLine2"
        });
        
        // add dotted line connectors
        layer.add(poly);
        layer.add(poly2);
       
        /*
         * update the dotted line points before
         * drawing the layer
         */
        layer.beforeDraw(function() {
          updateDottedLines(layer);
        });
        /*
         * add custom property curve objects to layer so that
         * they can be modified by reference
         */
        layer.poly = {
	          start: buildAnchor(layer, 626,401),
	          control1: buildAnchor(layer, 628,324),
	          control2: buildAnchor(layer, 744,324),
	          control3: buildAnchor(layer, 994,323),
	          control4: buildAnchor(layer, 996,403),
	          end: buildAnchor(layer, 628,402)
        };
        
        stage.on("mouseout", function() {
          layer.draw();
        });

        stage.add(layer);
      };
      
      function gatherPoints() {
    	  
   	 	var plyLine = layer.get('#polyLine')[0];
   	  	var txt = "";
   	 	
		for (obj in plyLine.getAttrs().points) {
			
			//posObj=poyLine.getAttrs().points()[obj].getPosition();
			//txt= txt+"id:"+currObj.occLyr.children[obj]._id+" X="+posObj.x+" Y="+posObj.y+"\n";
			var X = plyLine.getAttrs().points[obj].x;
			var Y = plyLine.getAttrs().points[obj].y;
			txt = txt + X +','+ Y + ',';
		};
		//alert("txt=" + txt);
		$('#area').val(txt);
		//txt = txt + "\n\n[FloorFeatures for '" + this.currFloor  + "' floor]" ;
    	  
    	  
      }
    </script>
  </head>
  <body>
    <div id="container"></div>
    <div id="txt">
    	<input value="pressMe" type="button" onclick="gatherPoints()"/>
    	<textarea rows="10" cols="50" id="area"></textarea>
   	</div>
  </body>
</html>