<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Regina Logistics</title>
<style type="text/css">
<!--
@import url("./css/default.css");
-->
</style>
<script src="./libraries/kinetic-v3.9.2.js"></script>
<script type="text/javascript" src="controller/application.js"></script>
<script src="./libraries/jquery-1.7.2.min.js"></script>
<script>

var stage;
var lyrImg;
var lyrIcons;
var lyrs = new Array();
var imageObj;
var imgObj1;
var imgObj2;
var locMap = new Array("100A;245;186","100B;245;217","101A;314;186","101B;314;217","102A;389;186","102B;389;217","103A;453;179","103B;453;207","104A;588;176","104B;588;206","105A;655;179","105B;655;210","106A;726;180","106B;726;210","107A;800;189","107B;800;212","108A;863;165","109A;925;144","109B;925;173","110A;1007;135","110B;1002;164","111A;670;346","111B;703;345","111C;819;357","111D;849;357");

window.onload = function() {

	//Prepare stage
	stage = new Kinetic.Stage({
		container : "container",
		width : 1164,
		height : 500
	});
	
	//Prepare image layer
	lyrImg = new Kinetic.Layer();
	imageObj = new Image();
	imageObj.onload = function() {
		var image = new Kinetic.Image({
			x : 0,
			y : 20,
			image : imageObj,
			width : 1164,
			height : 500,
			name: "floorImg"
		});
		lyrImg.add(image);
		stage.add(lyrImg);
	};
	imageObj.src = "./images/piano_rialzato_edificio_B_50.jpeg";
	
	//Prepare female/male icons
	imgObj1 = new Image();
	imgObj1.src = "./images/female_pre_20.png";
	
	imgObj2 = new Image();
	imgObj2.src = "./images/female_occ_20.png";
	
	imgObj2.onload = function() {
			loadLocations(1);
     };

};

function loadLocations(val) {
	
	if (lyrs[val] == undefined) {

		lyrs[val] = new Kinetic.Layer();
		var image;
		var xVal;
		var yVal;
		var idElem;
		var zoomFact = 1.07;
		var obj;
		
		for (i=0;i<locMap.length;i++) {
		    
		 	if (Math.floor((Math.random()*2)+1) == 1) {
				obj = imgObj1;
			} else {
				obj = imgObj2;
			};
		    
		    xVal = locMap[i].split(";")[1];
		    yVal = locMap[i].split(";")[2];
		    idElem = locMap[i].split(";")[0];
		    
			image = new Kinetic.Image({
					x : xVal*zoomFact,
					y : yVal*zoomFact,
					image : obj,
					width : 20,
					height : 20,
					id: idElem
			        });
			lyrs[val].add(image);
			//stage.add(lyrs[val]);
		};
	};
	stage.add(lyrs[val]);
	lyrImg.moveToTop();
	lyrs[val].moveToTop();
	
};

function dayChange(obj) {
	
	document.getElementById("dayvalue").innerHTML=obj.value;
	loadLocations(obj.value);
	
};
</script>
</head>
<body>
<!-- 	<img src="./images/piano_rialzato_edificio_B_50.jpeg"/> -->
	<div id="container"></div>
	<div class="selectors" style="float: left">
		<label>Anno</label>
		<select id="year">
			<option value="2011">2011</option>
			<option value="2012">2012</option>
			<option value="2013">2013</option>
		</select>
	</div>
	<div class="selectors">
		<label>Mese</label> 
		<select id="month">
			<option value="1">Gennaio</option>
			<option value="2">Febbraio</option>
			<option value="3">Marzo</option>
			<option value="Aprile">Aprile</option>
		</select>
	</div>
	<div class="selectors">
		<input type="range" id="day" min="1" max="31" style="width: 745px" onchange="dayChange(this)"/>
	</div>
	<div class="selectors"><div id="dayvalue">15</div></div>
</body>
</html>